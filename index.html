<!DOCTYPE html>
<html lang="en"> 
<head>
    <link rel="stylesheet" href="main.css" type="text/css">
    <meta charset="UTF-8">
    <title>Fourth-Dimensional Pocket</title>  
</head>
<body>
    <header>Fourth-Dimensional Pocket</header>
<div class="content">
    <nav class="menu">
        <p>Categories</p>
        <ui id="menuList"></ui>        
    </nav>
    <section>
            <section class="dropdown">

                    <button class="dropbtn">Shopping List $2</button>

                    <div class="dropdown-content">
                        <p>Shopping List (Total:$2.0)</p>
                        <table>
                                <tr><td>Dokodemo door</td>  <td>Quantity: <input type="number"> @1.0</td></li>
                                <tr><td>Time Machine</td>  <td>Quantity: <input type="number"> @2.0</td></li>
                        </table>
                        <button>Checkout</button>        
                    </div>    

            </section>    
            <hr>
            <p id='path'><a href = "main.html">Home</a> > <span>ALL</span></p>
            <ui id="products"></ui>
        
    </section>
    
</div> 
<footer>Doraemon</footer>
<script type="text/javascript" src="incl/myLib.js"></script>
<script type="text/javascript">
(function(){

	function updateUI() {
		myLib.get({action:'cat_fetchall'}, function(json){
			// loop over the server response json
            //   the expected format (as shown in Firebug): 
			for (var listItems = [],i = 0, cat; cat = json[i]; i++) {
                //<li><a href="weapon.html">Weapon</a></li>
                //listItems.push('<li id="cat' , parseInt(cat.catid) , '"><span class="name">' , cat.name.escapeHTML() , '</span> <span class="delete">[Delete]</span> <span class="edit">[Edit]</span></li>');
                listItems.push('<li id="cat',parseInt(cat.catid),'"><span class="name">',cat.name.escapeHTML(),'</span></li>');
			}
            el('menuList').innerHTML = listItems.join('');
		});

            
    }
    function updateProduct(){
        var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() { 
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
        
					result = xmlHttp.responseText.split('while(1);');
					result = JSON.parse(result[1]);
					result = result["success"];					
					for (var listItems = [], i = 0, prod; prod = result[i]; i++) {
                        listItems.push('<li class="product-list"<div><a href = "product.html?pid=',parseInt(prod.pid),'"><img src="incl/img/',parseInt(prod.pid),'.jpg"></img></a><a href = "product.html?pid=',parseInt(prod.pid),'"><p>',prod.name.escapeHTML(),'</p></a><p>$ ',parseInt(prod.price),'</p><button>Add to Cart</button></div></li>');
                    }
                    el('products').innerHTML = listItems.join('');
				}	
			}
			xmlHttp.open("GET", "main.php?action=prod_fetchall", true); // true for asynchronous 
            xmlHttp.send();
    }
    updateUI();
    updateProduct();

    el('menuList').onclick = function(e) {
        
		if (e.target.tagName != 'SPAN')
			return false;

		var target = e.target,
			parent = target.parentNode,
			id = target.parentNode.id.replace(/^cat/, ''),
            name = target.parentNode.querySelector('.name').innerHTML;
  
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() { 
				if (xmlHttp.readyState == 4 && xmlHttp.status == 200){

                    el('products').innerHTML = "";
                    el('path').innerHTML = '<a href = "main.html">Home</a> <span> > </span>';
                    el('path').innerHTML += '<span id = cat'+ id +'>' + name.escapeHTML() + '</span>';     
					result = xmlHttp.responseText.split('while(1);');
                    result = JSON.parse(result[1]);
                    result = result["success"];				
					for (var listItems = [], i = 0, prod; prod = result[i]; i++) {
                        listItems.push('<li class="product-list" id = prod',parseInt(prod.pid),'><div><a href = "product.html?pid=',parseInt(prod.pid),'"><img src="incl/img/',parseInt(prod.pid),'.jpg"></img></a><a href = "product.html?pid=',parseInt(prod.pid),'"><p>',prod.name.escapeHTML(),'</p></a><p>$ ',parseInt(prod.price),'</p><button>Add to Cart</button></div></li>');
                    }
                    el('products').innerHTML = listItems.join('');
				}	
			// populate the product list or navigate to admin.php?catid=<id>
        }
        xmlHttp.open("GET", "main.php?action=prod_fetchbycat&catid="+id, true); // true for asynchronous 
		xmlHttp.send();
	}
	
	


})();
</script>
</body>
</html>
